<html>

<head>
    <script>
        // alert messages and notifications
        function alertBox(num, counter) {
            //open modal: data-toggle = "modal" data-target = "#messageModal"
            // adding data: $('#modalDate').html(reqDate); // dismiss: data-dismiss="modal"
            var message = $('#message');
            var Notif_Array = [
                    '',
                    'Fetch request failed!',
                    'There are ' + counter + ' new booking request made for today.',
                    'No more booking request for today.',
                    'There are ' + counter + ' new booking request made for this week.',
                    'No more booking request for this week.',
                    'Book list removed successfully!',
                    '<span class="text-success">Request is Accepted.</span><br>It is and moved to Decided List!',
                    '<span class="text-danger">Request is Rejected.</span><br>It is and moved to Decided List!'
                ]
                // update message
            message.html(Notif_Array[num]);

            var msgTitle = '';
            if ((num !== 1)) {
                msgTitle = '<h4 class="text-success">Notification</h4>';

            } else {
                msgTitle = '<h4 class="text-danger">Warning!</h4>'
            }
            $('#modal-title').html(msgTitle);

            // show message
            $('#messageModal').modal('show');

        }

        function first_last_Date_Objects() {
            var thisWeekArray = new Array();

            var today = date_call(10); //Thursday, March 11, 2021
            var todayNum = date_call(1); // 6, (0 - 6)
            var todayNumMonth = date_call(9); // 17, (1 - 31)
            var todayYear = date_call(6); // 2021
            var todayMonth = date_call(3); // 02 (0 - 11)

            // always sunday full format date
            var firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay;

            if (todayNum == 0) { // sunday 
                firstDay = new Date(todayYear, todayMonth, todayNumMonth);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth + 1);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth + 2);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth + 3);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth + 4);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth + 5);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth + 6);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            } else if (todayNum == 1) { // Monday
                firstDay = new Date(todayYear, todayMonth, todayNumMonth - 1);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth + 1);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth + 2);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth + 3);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth + 4);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth + 5);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            } else if (todayNum == 2) { // Tuesday
                firstDay = new Date(todayYear, todayMonth, todayNumMonth - 2);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth - 1);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth + 1);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth + 2);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth + 3);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth + 4);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            } else if (todayNum == 3) { // Wednesday
                firstDay = new Date(todayYear, todayMonth, todayNumMonth - 3);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth - 2);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth - 1);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth + 1);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth + 2);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth + 3);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            } else if (todayNum == 4) { // Thursday
                firstDay = new Date(todayYear, todayMonth, todayNumMonth - 4);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth - 3);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth - 2);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth - 1);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth + 1);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth + 2);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            } else if (todayNum == 5) { // Friday
                firstDay = new Date(todayYear, todayMonth, todayNumMonth - 5);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth - 4);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth - 3);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth - 2);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth - 1);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth + 1);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            } else if (todayNum == 6) { // Saturday
                firstDay = new Date(todayYear, todayMonth, todayNumMonth - 6);
                secondDay = new Date(todayYear, todayMonth, todayNumMonth - 5);
                thirdDay = new Date(todayYear, todayMonth, todayNumMonth - 4);
                fourthDay = new Date(todayYear, todayMonth, todayNumMonth - 3);
                fifthDay = new Date(todayYear, todayMonth, todayNumMonth - 2);
                sixthDay = new Date(todayYear, todayMonth, todayNumMonth - 1);
                seventhDay = new Date(todayYear, todayMonth, todayNumMonth);

                thisWeekArray = [firstDay, secondDay, thirdDay, fourthDay, fifthDay, sixthDay, seventhDay];
            }

            return thisWeekArray;
        }

        function weekDates(thisWeekDateObj) {
            var thisWeekDate;
            var str = '';
            var newDay, newDate, newDateName, newMonthNum, newMonthName, newYear;

            // find full format of first day of the week
            newDay = thisWeekDateObj.getDay(); // 0
            newDateName = date_call(7)[newDay]; // Sunday
            str = newDateName + ', '; // 'Sunday, '
            newMonthNum = thisWeekDateObj.getMonth(); // 2
            newMonthName = date_call(8)[newMonthNum]; // March
            str += newMonthName + ' '; // 'Sunday, March '
            newDate = thisWeekDateObj.getDate(); // 7
            str += newDate + ', '; // 'Sunday, March 7, '
            newYear = thisWeekDateObj.getFullYear(); // 2021
            str += newYear; // 'Sunday, March 7, 2021'

            thisWeekDate = str; // Thursday, March 11, 2021

            return thisWeekDate;
        }

        /* 
        this function produces an array of date data
        date_call[0] - date - current date: Sat Mar 06 2021 06:05:55 GMT-0500 (Eastern Standard Time)
        date_call[1] - dateNumWeek - current date num: 6, (0 - 6)
        date_call[2] - dateName - current date num: Saturday
        date_call[3] - calMonthNum - current month num: 2 (starts count from 0)
        date_call[4] - calMonthNumCorrected - adds 1 to month: 3
        date_call[5] - calMonthName - current month name: March
        date_call[6] - theYear - adds 1 to month: 2021
        date_call[7] - weekdays - weedays array 
        date_call[8] - months - months array
        date_call[9] - dateNumMonth - current date num: 15, (1-31)
        date_call[10] - fullDayToday - // Thursday, March 4, 2021

        it receives one arguments: the array number
        then it returns the required date value
        to call this func: var today = date_call(n);
    */
        function date_call(num) {
            var date = new Date(); //Sat Mar 06 2021 06:05:55 GMT-0500 (Eastern Standard Time)
            var dateNumWeek = date.getDay(); // 6, (0 - 6)
            var dateNumMonth = date.getDate(); // 15, (1-31)
            var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            var dateName = weekdays[date.getDay()]; // Saturday  
            var calMonthNum = date.getMonth(); // 2 (starts from 0)
            var calMonthNumCorrected = date.getMonth() + 1; // 3
            var months = [
                "January", "February", "March",
                "April", "May", "June", "July", "August",
                "September", "October", "November", "December"
            ];
            var calMonthName = months[date.getMonth()]; // March
            var theYear = date.getFullYear(); // 2021
            var fullDayToday = dateName + ', ' +
                calMonthName + ' ' +
                dateNumMonth + ', ' +
                theYear; // Thursday, March 4, 2021

            var dateArr = [
                date, dateNumWeek, dateName, calMonthNum,
                calMonthNumCorrected, calMonthName, theYear,
                weekdays, months, dateNumMonth, fullDayToday
            ]; // holds date formats

            return dateArr[num];
        }


        // fetch all hours from db:  
        $('#allRequests').click(function(e) {
            // var url = "https://3i71kk5ced.execute-api.us-east-1.amazonaws.com/GetRecordsTest/getdynamodbitems";
            // var url_two = 'https://prototype1-0.s3.amazonaws.com/luxlab2.0/getRecordsFromDB+-+Copy.html';

            $.ajax({
                url: 'https://3i71kk5ced.execute-api.us-east-1.amazonaws.com/GetRecordsTest/getdynamodbitems',
                type: "GET",

                success: function(data) {
                    var tr = ''; // row

                    data.Items.forEach(function(Item) {
                        tr += '<tr><td><div>' + Item.name.S +
                            '<br>' + Item.phone.S +
                            '<br>' + Item.email.S + '</div></td>';
                        tr += '<td><div>' + Item.date.S +
                            '<br>' + Item.time.S + '</div></td>';
                        tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                        tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                    });

                    $('#requested_decision_List').html(tr); // update table
                    // $('#requested_decision_List').append(tr); // update table
                },
                error: function() {
                    // alert('fetch request failed!');
                    alertBox(1, 0);
                }
            });



        });

        // fetch daily Hours 
        $('#todayRequests').click(function(e) {
            var counter = 0;

            var today = date_call(10); //Thursday, March 11, 2021
            // alert(today)
            $.ajax({
                url: 'https://3i71kk5ced.execute-api.us-east-1.amazonaws.com/GetRecordsTest/getdynamodbitems',
                type: "GET",

                success: function(data) {
                    var tr = ''; // row

                    data.Items.forEach(function(Item) {

                        if (Item.date.S === today) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }

                    });

                    if (counter > 0) {
                        // alert('There are ' + counter + ' new booking request made for today.');
                        // today = 1;
                        alertBox(2, counter);
                    } else {
                        // alert('No more booking request for today.');
                        alertBox(3, counter);
                    }

                    $('#requested_decision_List').html(tr); // update table
                    // $('#requested_decision_List').append(tr); // update table
                },
                error: function() {
                    // alert('fetch request failed!');
                    alertBox(1, counter);
                }
            });

        });

        // fetch weekly hours
        $('#thisWeekRequests').click(function(e) {
            var counter = 0;

            var thisWeek = first_last_Date_Objects(); // saves array of date objects

            var thisWeekDatesArray = new Array(); // saves array of dates : Thursday, March 11, 2021

            for (var i = 0; i < thisWeek.length; i++) {
                thisWeekDatesArray[i] = weekDates(thisWeek[i]);
            }

            $.ajax({
                url: 'https://3i71kk5ced.execute-api.us-east-1.amazonaws.com/GetRecordsTest/getdynamodbitems',
                type: "GET",

                success: function(data) {
                    var tr = ''; // row

                    data.Items.forEach(function(Item) {

                        if (Item.date.S === thisWeekDatesArray[0]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }
                        if (Item.date.S === thisWeekDatesArray[1]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }
                        if (Item.date.S === thisWeekDatesArray[2]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }
                        if (Item.date.S === thisWeekDatesArray[3]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }
                        if (Item.date.S === thisWeekDatesArray[4]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }
                        if (Item.date.S === thisWeekDatesArray[5]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }
                        if (Item.date.S === thisWeekDatesArray[6]) {
                            tr += '<tr><td><div>' + Item.name.S +
                                '<br>' + Item.phone.S +
                                '<br>' + Item.email.S + '</div></td>';
                            tr += '<td><div>' + Item.date.S +
                                '<br>' + Item.time.S + '</div></td>';
                            tr += '<td><div><input type="submit" value="Accept" onClick="acceptRequest(event)" class="btn btn-success btn-block accept">';
                            tr += '<input type="submit" value="Reject" onClick="rejectRequest(event)" class="btn btn-danger btn-block reject"></div></td></tr>';

                            counter++;
                        }

                    });

                    if (counter > 0) {
                        // alert('There are ' + counter + ' new booking request made for this week.');
                        alertBox(4, counter);
                    } else {
                        // alert('No more booking request for this week.');
                        alertBox(5, counter);
                    }

                    $('#requested_decision_List').html(tr); // update table
                    // $('#requested_decision_List').append(tr); // update table
                },
                error: function() {
                    // alert('fetch request failed!');
                    alertBox(1, counter);
                }
            });

        });

        /*
            accept request
            remove it from request list > add it to accepted table (append)
            when adding to accepted table, remove decision column. instead add label 'accepted'
        */
        function acceptRequest(e) {
            var i = e.target; // <input> obj
            var parentRow = $(i).parent().parent().parent(); // tr obj
            var rowHtml = parentRow[0]; // covert to html
            parentRow.remove(); // remove the jquery object row
            var td = '<td><div class="text-success"><strong>Accepted</strong></div></td>';
            $(rowHtml).each(function() {
                $(this).children('td').eq(2).remove(); // removes the buttons
                $(this).append(td); // add label
            });
            $(rowHtml).css('background', '#f3fccf'); // color code green

            $('#decidedList').append(rowHtml);

            // send decision to database

            // notification
            alertBox(7, 0);
        }

        // reject request
        function rejectRequest(e) {
            var i = e.target; // <input> obj
            var parentRow = $(i).parent().parent().parent(); // tr obj
            var rowHtml = parentRow[0]; // covert to html
            parentRow.remove(); // remove the jquery object row
            var td = '<td><div class="text-danger"><strong>Rejected</strong></div></td>';
            $(rowHtml).each(function() {
                $(this).children('td').eq(2).remove(); // removes the buttons
                $(this).append(td); // add label
            });
            $(rowHtml).css('background', '#fcd5cf'); // color code red

            $('#decidedList').append(rowHtml);

            // send decision to database

            // notification
            alertBox(8, 0);
        }
    </script>
</head>

<body>
    <!--  ======================= content body =======================  -->
    <div class="spacer-1"></div>
    <div class="container" id="tempoContent">
        <div class="row">

            <div class="col-lg-8 fade-in card-on">
                <h1>Decision Table</h1>
                <p><code>This is for lux lab hair salon Staff</code></p>

                <!--list of requests-->
                <h3 class="display-5 text-center mt-5">List of Requests</h3>

                <div class="col-lg-12">
                    <div class="col-xs-4">
                        <input type="submit" value="Today" id="todayRequests" class="btn btn-primary btn-block">
                    </div>
                    <div class="col-xs-4">
                        <input type="submit" value="Weekly" id="thisWeekRequests" class="btn btn-primary btn-block">
                    </div>
                    <div class="col-xs-4">
                        <input type="submit" value="All" id="allRequests" class="btn btn-primary btn-block">
                    </div>
                </div>

                <!-- <div class="spacer-1"></div> -->

                <table id="decisionTbl" class="table table-striped">
                    <thead>
                        <tr>
                            <th>
                                <div>Customer Info</div>
                            </th>
                            <th>
                                <div>Date & Time</div>
                            </th>
                            <th>
                                <div class="text-center">Decision</div>
                            </th>
                        </tr>
                    </thead>

                    <tbody id="requested_decision_List"></tbody>

                </table>
                <!-- /list of requests -->

                <!-- <div class="spacer-2"></div> -->

                <!-- modal 2 -->
                <div class="modal fade mb-5" tabindex="-1" role="dialog" id="messageModal">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
                                <h4 class="modal-title" id="modal-title">Notification</h4>

                            </div>

                            <div class="modal-body">
                                <form class="request-form">
                                    <div class="form-row">

                                        <div id="message"></div>

                                    </div>
                                </form>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- /modal 2 -->

            </div>
            <!-- /col 1 -->

            <div class="col-lg-4 fade-in">
                <div class="col-md-12 text-center card-on">
                    <h3 class="display-5 text-center mt-5">Decisions Passed</h3>

                    <table class="table table-striped mt-5">

                        <thead>
                            <tr>
                                <th>
                                    <div>Customer Info</div>
                                </th>
                                <th>
                                    <div>Date & Time</div>
                                </th>
                                <th>
                                    <div class="text-center">Decision</div>
                                </th>
                            </tr>
                        </thead>

                        <tbody id="decidedList"></tbody>

                    </table>

                    <!-- <div class="spacer-2"></div> -->

                </div>

            </div>
            <!-- /col 2 -->
        </div>
    </div>
    <!-- content body ends-->

    <div class="spacer-1"></div>

    <!-- script -->
    <script>
        /* slider script */
        // $(function() {
        //     var box = $('.fade-in');

        //     // box
        //     box.animate({
        //         top: 0,
        //         opacity: '0'
        //     });

        //     box.animate({
        //         top: 50,
        //         opacity: '1'
        //     });
        // });
    </script>

</body>

</html>