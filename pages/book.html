<html><head> 
</head><body>
<!--  ======================= content body =======================  -->
<div class="spacer-1"></div>
<div class="container" id="tempoContent">
    <div class="row">
        
        <div class="col-md-8 text-center fade-in">
            <div class="card">
                <h1>Request Data and time for Calendar DB</h1>
            	<p><strong>Please fill in the form and click save.</strong></p>
            	
            	<!-- calendar -->
            	<table class="table table-striped text-center table-hover table-responsive-lg" id="calendarForm">
            		<thead>
            			<tr>
            				<th colspan="7">February</th>
            			</tr>
            			<tr>
            				<th>Su</th>
            				<th>Mo</th>
            				<th>Tu</th>
            				<th>We</th>
            				<th>Th</th>
            				<th>Fr</th>
            				<th>Sa</th>
            			</tr>
            		</thead>
            		<tbody id="calendar">
            			<tr>
            				<td>1</td>
            				<td>2</td>
            				<td>3</td>
            				<td>4</td>
            				<td>5</td>
            				<td>6</td>
            				<td>7</td>
            			</tr>
            			<tr>
            				<td>8</td>
            				<td>9</td>
            				<td>10</td>
            				<td>11</td>
            				<td>12</td>
            				<td>13</td>
            				<td>14</td>
            			</tr>
            			<tr>
            				<td>15</td>
            				<td>16</td>
            				<td>17</td>
            				<td>18</td>
            				<td>19</td>
            				<td>20</td>
            				<td>21</td>
            			</tr>
            			<tr>
            				<td>22</td>
            				<td>23</td>
            				<td>24</td>
            				<td>25</td>
            				<td>26</td>
            				<td>27</td>
            				<td>28</td>
            			</tr>
            			<tr>
            				<td>29</td>
            				<td>30</td>
            				<td></td>
            				<td></td>
            				<td></td>
            				<td></td>
            				<td></td>
            			</tr>
            		</tbody>
            	</table> <!-- calendar ends -->
            	
            	<!-- forms -->
            	<form>
            		<div class="form-row">
            					    
            			<div class="col-md-4 mb-3">
            				<label for="validationDefault01">Full Name</label>
            				<input type="text" class="form-control" id="cusName" placeholder="Full Name ... " required>
            			</div>
            			<div class="col-md-4 mb-3">
            				<label for="validationDefault02">Phone Number</label>
            				<input type="text" class="form-control" id="cusPhone" placeholder="Phone Number ..." required>
            			</div>
            			<div class="col-md-4 mb-3">
            				<label for="validationDefaultEmail">Email</label>
            				<div class="input-group">
            					<input type="email" class="form-control" id="cusEmail" placeholder="Email address ..." aria-describedby="inputGroupPrepend2" required>
            				</div>
            			</div>
            
            			<!-- modal -->
            			<div class="modal fade mb-5" tabindex="-1" role="dialog" id="calModal">
            				<div class="modal-dialog modal-dialog-centered" role="document">
            					<div class="modal-content">
            					    <div class="modal-header">
            					    	<h5 class="modal-title">Hours available for the day</h5>
            							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
            								<span aria-hidden="true">&times;</span>
            							</button>
            					    </div>
            
            					    <div class="modal-body">
            					    	<h2>Day: <span class="text-primary" id="selectedDate"></span></h2>
            
            					    	<table class="table table-striped table-responsive-lg table-hover" id="hoursDiv">
            					    		<tbody>
            					    			<tr id="hoursDiv"></tr>
            					    		</tbody>
            					    	</table>
            					    </div>
            
            					    <div class="modal-footer">
            					    	<!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                    					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            					    </div>
            
            					 </div>
            				 </div>
            			 </div>
            					    
            			<div class="spacer-1"></div>

            			<input type="submit" id="sendRequest" value="Send Request" class="btn btn-primary btn-block">
            			
            		</div>
            	</form> <!-- forms ends -->
            </div>
        </div> <!-- col 8 ends -->
        
		<div class="col-md-4 fade-in"> 
            <div class="card">
                <div>
            		<h1>Display selections</h1>
            		<div id="shortData"></div>

					<div class="spacer-2"></div>
					<div class="spacer-1"></div>
            	</div>
            </div>
        </div> <!-- col 4 ends -->
        
    </div>
</div> <!-- content body ends-->

<div class="spacer-1"></div>

<!-- jQuery file -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- script -->
<script>
    /* slider script */
    $(function(){
        var box = $('.fade-in');
        
        // box
        box.animate({
            top: 0,
            opacity: '0'
        });
        
        box.animate({
            top: 50,
            opacity: '1'
        });
    });
    


    // on click, capture calendar day
    $('#calendarForm').find('td').on('click', function(){
   	// add focus on new selection
     $(this).addClass('focus');
     $(this).css('background', '#333');
        $(this).css('color','#fff');
    
        // Remove focus from selection
        $('td').removeClass('focus');
        $(this).css('background', '#fff');
        $(this).css('color','#222');
    
     
        // save the date text inside cell
        var reqDate = '';
        reqDate = $(this).text();
                            
        // get data from hourCalendar and display on modal
        $.get("./assets/php/book/getBook.php", function(data, status){
         var obj = jQuery.parseJSON( data );
         var str = '';
            // alert('php working');
            
         $.each(obj, function(key,value) {
             if(value.id == reqDate){
                 str += '<td><h4 class="text-success">' + value.crTime + '</h4></td>';
                 
                reqDate += ' (' + value.crDate + ')';
             } 
            //  else if(value.id != reqDate){
            //      str = '<h4 class="text-danger">unavailable</h4>';
            //  }
         });
                             
         // add data to modal tbody
            $('#hoursDiv').html(str);
                                
     }); // ... get method ends
                            
        // trigger modal pop up
        $(this).attr('data-toggle','modal');
        $(this).attr('data-target','#calModal');
                            
                                
        // put selected date on modal header
        $('#selectedDate').html(reqDate); 
                            
        
        // SAVING HOUR SELECTION
     // if modal td selected, post data
     $('#hoursDiv').on('click', function(e){
         // e.preventDefault();
         
         var reqHour = $("#hoursDiv").text();
         
         // dismiss modal after selection
         $(this).attr('data-dismiss','modal');
                             
         // fetch data from form
         var cusName = $("#cusName").val();
         var cusPhone = $("#cusPhone").val();
         var cusEmail = $("#cusEmail").val();
                             
         // display selected time to customer
         var s = 'Requested Date: <span class="text-success">' + reqDate + '</span><br>'
             + 'Reqested Hour: <span class="text-success">' + reqHour + '</span>';
         $('#shortData').html('<h3>' + s + '</h3>');
         
             
         // on button click, post request to database
         $('#sendRequest').click(function(){
             // fetch data from form
             var cusName = $("#cusName").val();
             var cusPhone = $("#cusPhone").val();
             var cusEmail = $("#cusEmail").val();
             
     // 		alert("cusName: " + cusName + ", \ncusPhone: " + cusPhone 
     // 		    + ", cusEmail: " + cusEmail + ", \nreqDate: " + reqDate
     // 		    + ", reqHour: " + reqHour + ", \nBooked!!!");
             alert('Request Sent Successfully!!');
             
             $.post("./assets/php/book/postBook.php",
             {
                 // name: "Donald Duck",
                 cusName: cusName,
                 cusPhone: cusPhone,
                 cusEmail: cusEmail,
                 reqDate: reqDate,
                 reqHour: reqHour
             },
             function(data, status){
                 // alert("Data: " + data + "\nStatus: " + status);
             });
             
             // display selected time to customer
             var s2 = '<hr> <span class="text-success">Request sent!</span><br>'
                 + '<p class="text-danger">Please check your email for comfirmation within 20 minutes</p>';
             $('#shortData').html('<h3>' + s2 + '</h3>');
             
         });
         
     });
     
     
    });
</script>

</body></html>


